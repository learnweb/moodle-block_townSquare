{"version":3,"file":"postletter.min.js","sources":["../src/postletter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {getString} from \"core/str\";\n//import Prefetch from \"../../../../lib/amd/src/prefetch\";\n\n/**\n * Javascript for the post letter\n *\n * @module     block_townsquare/postletter\n * @copyright  2023 Tamaro Walter\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nconst contentElements = document.getElementsByClassName('postletter_message');\nconst buttons = document.getElementsByClassName('townsquare_showmore');\nconst originalTexts = [];\n\nconst Selectors = {\n    actions: {\n        seemorebutton: '[data-action=\"block_townsquare/showmore_button\"]',\n    },\n};\n\n// TODO: The <p> parameter gets lost with this method. Search for a better solution.\n// TODO: Don't cut within a word or after a space.\n/**\n * Init function\n *\n * The function should cut the text if it is too long\n */\nexport function init() {\n    // Go through all elements and check if the text is too long.\n    contentElements.forEach(\n        (element) => {\n            if (element.textContent.length >= 250) {\n                // If the text is too long, cut it.\n                originalTexts[element.id] = element.textContent;\n                element.textContent = element.textContent.substring(0,250) + \"...\";\n                buttons[element.id].setAttribute('showmore', 'true');\n            } else {\n                // If the text is not too long, hide the show more button.\n                buttons[element.id].style.display = \"none\";\n            }\n        }\n    );\n    registerEventListener();\n}\n\n/**\n * Event listener for the show more/show less button.\n */\nconst registerEventListener = () => {\n    document.addEventListener('click', e => {\n        if (e.target.closest(Selectors.actions.seemorebutton)) {\n            // Get the id of the clicked element.\n            let letterid = e.target.id;\n            contentElements.forEach(\n                (element) => {\n                    if (element.id == letterid) {\n                        if (buttons[letterid].getAttribute('showmore')) {\n                            element.textContent = originalTexts[letterid];\n                            buttons[letterid].textContent = getString('showless', 'block_townsquare');\n                            buttons[letterid].setAttribute('showmore', 'false');\n                        } else {\n                            element.textContent = element.textContent.substring(0,250) + \"...\";\n                            buttons[letterid].textContent = getString('showmore', 'block_townsquare');\n                            buttons[letterid].setAttribute('showmore', 'true');\n                        }\n                    }\n                }\n            );\n        }\n    });\n};\n"],"names":["contentElements","forEach","element","textContent","length","originalTexts","id","substring","buttons","setAttribute","style","display","registerEventListener","document","getElementsByClassName","Selectors","seemorebutton","addEventListener","e","target","closest","letterid","getAttribute"],"mappings":"sKA4CIA,gBAAgBC,SACXC,UACOA,QAAQC,YAAYC,QAAU,KAE9BC,cAAcH,QAAQI,IAAMJ,QAAQC,YACpCD,QAAQC,YAAcD,QAAQC,YAAYI,UAAU,EAAE,KAAO,MAC7DC,QAAQN,QAAQI,IAAIG,aAAa,WAAY,SAG7CD,QAAQN,QAAQI,IAAII,MAAMC,QAAU,UAIhDC;;;;;;;;MAhCEZ,gBAAkBa,SAASC,uBAAuB,sBAClDN,QAAUK,SAASC,uBAAuB,uBAC1CT,cAAgB,GAEhBU,kBACO,CACLC,cAAe,0DAgCjBJ,sBAAwB,KAC1BC,SAASI,iBAAiB,SAASC,OAC3BA,EAAEC,OAAOC,QAAQL,kBAAkBC,eAAgB,KAE/CK,SAAWH,EAAEC,OAAOb,GACxBN,gBAAgBC,SACXC,UACOA,QAAQI,IAAMe,WACVb,QAAQa,UAAUC,aAAa,aAC/BpB,QAAQC,YAAcE,cAAcgB,UACpCb,QAAQa,UAAUlB,aAAc,kBAAU,WAAY,oBACtDK,QAAQa,UAAUZ,aAAa,WAAY,WAE3CP,QAAQC,YAAcD,QAAQC,YAAYI,UAAU,EAAE,KAAO,MAC7DC,QAAQa,UAAUlB,aAAc,kBAAU,WAAY,oBACtDK,QAAQa,UAAUZ,aAAa,WAAY"}