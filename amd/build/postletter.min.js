define("block_townsquare/postletter",["exports","core/str","core/prefetch"],(function(_exports,_str,_prefetch){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(){(0,_prefetch.prefetchStrings)("moodle",["showmore","showless"]),contentElements.forEach((element=>{!async function(element){let message=element.innerHTML;const firstPTag=message.indexOf("<p>"),lastPTag=message.lastIndexOf("</p>");message=message.replace(/<p>&nbsp;<\/p>/g,"").replace(/&nbsp;/g,""),message=message.substring(0,firstPTag+3)+message.substring(firstPTag+3,lastPTag).replace(/<p>/g,"<br>").replace(/<\/p>/g,"")+message.substring(lastPTag),element.innerHTML=message}(element),element.textContent.length>=250?(originalTexts[element.id]=element.innerHTML,cutString(element),element.parentElement.insertAdjacentHTML("beforeend","<p>"),buttons[element.id].setAttribute("showmore","true")):buttons[element.id].style.display="none"})),addEventListener()};
/**
   * Javascript for the post letter
   *
   * This file implements 2 functionalities:
   * - cuts posts that have many characters and shows a "see more" Button to see the whole text.
   * - Unnecessary <p> Tags from the Database are being replaced with line breaks to make the text more readable.
   *
   * @module     block_townsquare/postletter
   * @copyright  2023 Tamaro Walter
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const contentElements=document.getElementsByClassName("postletter_message"),buttons=document.getElementsByClassName("townsquare_showmore"),originalTexts=[],Selectors_actions={seemorebutton:'[data-action="block_townsquare/showmore_button"]'};function cutString(element){let text=element.textContent,index=250;for(;" "!=text.charAt(index);)index++;element.innerHTML=text.substring(0,index)}const addEventListener=()=>{document.addEventListener("click",(e=>{if(e.target.closest(Selectors_actions.seemorebutton)){let letterid=e.target.id;contentElements.forEach((element=>{element.id==letterid&&("true"==buttons[letterid].getAttribute("showmore")?(element.innerHTML=originalTexts[letterid],changeButtonString(letterid,!1)):(cutString(element),changeButtonString(letterid,!0)))}))}}))};async function changeButtonString(index,toshowmore){1==toshowmore?(buttons[index].textContent=await(0,_str.getString)("showmore","moodle"),buttons[index].setAttribute("showmore","true")):(buttons[index].textContent=await(0,_str.getString)("showless","moodle"),buttons[index].setAttribute("showmore","false"))}}));

//# sourceMappingURL=postletter.min.js.map